<div class="container mx-auto p-6 space-y-8">
  <!-- Header Section -->
  <div class="bg-base-100 rounded-3xl shadow-2xl border border-base-content/10 p-6">
    <div class="flex items-center gap-4">
      <div class="w-3 h-16 bg-accent rounded-full"></div>
      <div>
        <h1 class="text-3xl font-bold text-base-content">{{ mediaName }}</h1>
        <p class="text-base-content/70" *ngIf="tvdbId">TVDB ID: {{ tvdbId }}</p>
      </div>
    </div>
  </div>

  <!-- Form Section -->
  <div id="editSection" class="lg:w-full bg-base-100 rounded-3xl shadow-2xl border border-base-content/10">
    <div class="p-6 border-b border-base-content/10">
      <div class="flex items-center gap-4">
        <div class="w-2 h-12 bg-primary rounded-full"></div>
        <h2 class="text-2xl font-bold">{{ editingRuleset ? 'Bearbeiten' : 'Hinzufügen' }} Ruleset</h2>
      </div>
    </div>

    <!-- Form Section -->
    <form [formGroup]="rulesetForm" (ngSubmit)="onSubmit()" class="p-6 space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="form-control">
          <label class="label font-medium">Thema</label>
          <input type="text" 
                 formControlName="topic" 
                 class="input bg-base-200/50 border-base-content/10 rounded-2xl transition-all duration-300 focus:ring-2 focus:ring-primary/50"
                 [placeholder]="mediaName"/>
        </div>
        
        <div class="form-control">
          <label class="label font-medium">Priority</label>
          <input type="number" 
                 formControlName="priority" 
                 class="input bg-base-200/50 border-base-content/10 rounded-2xl transition-all duration-300 focus:ring-2 focus:ring-primary/50"
                 placeholder="Enter priority number"/>
        </div>
      </div>

      <!-- Filters Section -->
      <div formArrayName="filters" class="space-y-4">
        <div class="p-4 bg-base-200/30 rounded-2xl border border-base-content/5">
          <h3 class="text-lg font-semibold mb-4">Filters</h3>
          
          <!-- Duration Info Display -->
          <ng-container *ngIf="durationInfo?.calculatedMin && !editingRuleset">
            <div class="mb-4 p-3 bg-base-200/50 rounded-xl border border-base-content/10">
              <div class="flex items-center gap-2 text-primary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="font-medium">Automatisch berechneter Duration-Filter</span>
              </div>
              <div class="mt-2 ml-6 text-sm text-base-content/70">
                <p>⌀ Laufzeit: {{ durationInfo.averageRuntime }}min</p>
                <p>Analysierte Episoden: {{ durationInfo.episodeCount }}</p>
                <p>Mindestlaufzeit (70%): {{ durationInfo.calculatedMin }}min</p>
              </div>
            </div>
          </ng-container>

          <app-ruleset-filter 
            *ngFor="let filter of filters.controls; let i=index" 
            [formGroup]="$any(filter)"
            (remove)="removeFilter(i)">
          </app-ruleset-filter>
          
          <button type="button" 
                  class="btn btn-primary btn-sm rounded-2xl mt-4" 
                  (click)="addFilter()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Add Filter
          </button>
        </div>
      </div>

      <!-- Regex Rules Section -->
      <div formArrayName="titleRegexRules" class="space-y-4">
        <div class="p-4 bg-base-200/30 rounded-2xl border border-base-content/5">
          <h3 class="text-lg font-semibold mb-4">Regex Rules</h3>
          <app-regex-rule 
            *ngFor="let rule of titleRegexRules.controls; let i=index"
            [formGroup]="$any(rule)"
            [predefinedRegexPatterns]="predefinedRegexPatterns"
            (remove)="removeTitleRegexRule(i)">
          </app-regex-rule>
          
          <button type="button" 
                  class="btn btn-primary btn-sm rounded-2xl mt-4" 
                  (click)="addTitleRegexRule()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Add Rule
          </button>
        </div>
      </div>

      <!-- Season/Episode Pattern Section -->
      <div class="p-4 bg-base-200/30 rounded-2xl border border-base-content/5">
        <h3 class="text-lg font-semibold mb-4">Season/Episode Patterns</h3>
        <div class="grid grid-cols-1 gap-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-control">
              <label class="label font-medium">Episode Regex</label>
              <input type="text" 
                     formControlName="episodeRegex" 
                     class="input bg-base-200/50 border-base-content/10 rounded-2xl transition-all duration-300 focus:ring-2 focus:ring-primary/50"/>
            </div>
            <div class="form-control">
              <label class="label font-medium">Season Regex</label>
              <input type="text" 
                     formControlName="seasonRegex" 
                     class="input bg-base-200/50 border-base-content/10 rounded-2xl transition-all duration-300 focus:ring-2 focus:ring-primary/50"/>
            </div>
          </div>

          <div class="form-control">
            <label class="label font-medium">Predefined Patterns</label>
            <select class="select bg-base-200/50 border-base-content/10 rounded-2xl transition-all duration-300 focus:ring-2 focus:ring-primary/50"
                    (change)="handleSeasonEpisodePatternChange($event)">
              <option value="">Select Pattern</option>
              <option *ngFor="let pattern of predefinedSeasonEpisodePatterns; let i = index" [value]="i">
                {{pattern.name}}
              </option>
            </select>
          </div>

          <div class="form-control">
            <label class="label font-medium">Matching Strategy</label>
            <select formControlName="matchingStrategy" 
                    class="select bg-base-200/50 border-base-content/10 rounded-2xl transition-all duration-300 focus:ring-2 focus:ring-primary/50">
              <option value="SeasonAndEpisodeNumber">Season + Episode</option>
              <option value="ByAbsoluteEpisodeNumber">LEGACY Absolute Episode Number</option>
              <option value="AbsoluteEpisodeNumber">Absolute Episode Number</option>
              <option value="ItemTitleExact">Item Title Exact</option>
              <option value="ItemTitleIncludes">Item Title Includes</option>
              <option value="ItemTitleEqualsAirdate">Item Title Equals Airdate</option>
            </select>
          </div>
        </div>
      </div>

      <div class="flex gap-3 pt-4">
        <button type="button" 
                class="btn btn-ghost flex-1 rounded-2xl" 
                (click)="resetForm()">
          Abbrechen
        </button>
        <button type="submit" 
                class="btn btn-primary flex-1 rounded-2xl" 
                [disabled]="!rulesetForm.valid">
          {{ editingRuleset ? 'Update' : 'Speichern' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Existing Rulesets List -->
  <div class="bg-base-100 rounded-3xl shadow-2xl border border-base-content/10" *ngIf="rulesets.length > 0">
    <div class="p-6 border-b border-base-content/10">
      <div class="flex items-center gap-4">
        <div class="w-2 h-12 bg-secondary rounded-full"></div>
        <h2 class="text-2xl font-bold">Vorhandene Rulesets</h2>
      </div>
    </div>
    
    <div class="p-6">
      <div class="space-y-4">
        <div *ngFor="let ruleset of rulesets" 
             class="bg-base-200/30 rounded-2xl border border-base-content/5 p-4 hover:shadow-lg transition-all duration-300">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-base-content">{{ ruleset.topic || 'Untitled Ruleset' }}</h3>
              <p class="text-sm text-base-content/70 mt-1">Priority: {{ ruleset.priority }}</p>
              <p class="text-sm text-base-content/70" *ngIf="ruleset.matchingStrategy">
                Strategy: {{ ruleset.matchingStrategy }}
              </p>
            </div>
            
            <div class="flex gap-2 ml-4">
              <button class="btn btn-sm btn-primary rounded-xl" 
                      (click)="editRuleset(ruleset)"
                      title="Edit Ruleset">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
              </button>
              
              <button class="btn btn-sm btn-secondary rounded-xl" 
                      (click)="duplicateRuleset(ruleset)"
                      title="Duplicate Ruleset">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
              </button>
              
              <button class="btn btn-sm btn-error rounded-xl" 
                      (click)="deleteRuleset(ruleset)"
                      title="Delete Ruleset">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
